–Ø –Ω–∞—à—ë–ª –æ—à–∏–±–∫–∏ –≤ —Ç–µ–∫—É—â–µ–º –∫–æ–¥–µ, –∏–∑-–∑–∞ –∫–æ—Ç–æ—Ä—ã—Ö –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ—Å—Ç–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ –∏ –ª–æ–º–∞–µ—Ç—Å—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∏–∫–æ–≤. –ò—Å–ø—Ä–∞–≤—å –ø—Ä–æ–µ–∫—Ç –ø–æ —à–∞–≥–∞–º:

üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ —Ñ–∞–π–ª–∞–º
1. bot.py

–£–¥–∞–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é persistent views —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏:

bot.add_view(TicketActionView(0, ""))
bot.add_view(RecheckApplicationView(0, ""))
bot.add_view(NicknameMismatchFixView(0, "", "", ""))
bot.add_view(ConfirmDeleteView(0,0))


–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π –∏—Ö –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

bot.add_view(ApplicationButton())
bot.add_view(DeleteApplicationView())
bot.add_view(ReadyButtonView())
bot.add_view(TicketActionView())
bot.add_view(RecheckApplicationView())
bot.add_view(NicknameMismatchFixView())
bot.add_view(ConfirmDeleteView())


–≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã persistent views —Ä–∞–±–æ—Ç–∞–ª–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞.

2. handlers/tickets.py

–£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤—Å–µ View –∏–º–µ—é—Ç:

timeout=None

—É–Ω–∏–∫–∞–ª—å–Ω—ã–π custom_id —É –∫–Ω–æ–ø–æ–∫

–≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (user_id, discord_nick, steam_nick) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é None

–ü—Ä–∏–º–µ—Ä:

class NicknameMismatchFixView(discord.ui.View):
    def __init__(self, user_id: int = None, discord_nick: str = None, steam_nick: str = None, real_name: str = None):
        super().__init__(timeout=None)
        self.user_id = user_id
        self.discord_nick = discord_nick
        self.steam_nick = steam_nick
        self.real_name = real_name


–ü—Ä–æ–≤–µ—Ä—å –≤—ã–∑–æ–≤—ã .send(). –£–±–µ—Ä–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ allowed_mentions. –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ:

await channel.send(content=msg, allowed_mentions=discord.AllowedMentions(users=True))

3. cogs/application_system.py

–£ –∫–Ω–æ–ø–æ–∫: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞—è–≤–∫—É –µ—â—ë —Ä–∞–∑", "–£–¥–∞–ª–∏—Ç—å –∑–∞—è–≤–∫—É", "–ü–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞—è–≤–∫—É", "–ì–æ—Ç–æ–≤–æ"
–¥–æ–±–∞–≤—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ custom_id, –Ω–∞–ø—Ä–∏–º–µ—Ä:

custom_id="recheck_application_v4"
custom_id="delete_application_v4"
custom_id="ready_button_v4"


–í —Ñ—É–Ω–∫—Ü–∏—è—Ö, –≥–¥–µ –æ—á–∏—â–∞–µ—Ç—Å—è –∫—ç—à Steam, –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π local_steam_cache –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

from handlers.tickets import local_steam_cache

4. handlers/novichok.py

–í —Ñ—É–Ω–∫—Ü–∏–∏ extract_steam_links() –∏—Å–ø—Ä–∞–≤—å –±–∞–≥: –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º re.finditer –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤—Ö–æ–¥—è—â–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä text ‚Äî —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑—É–π:

if not isinstance(text, str):
    text = str(text)

5. handlers/novichok_actions.py

–î–æ–±–∞–≤—å –æ—Ç–ø—Ä–∞–≤–∫—É embed –≤ –∫–∞–Ω–∞–ª üìÇ–ª–∏—á–Ω—ã–µ-–¥–µ–ª–∞ (ID: 1226224193603895386) –ø–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∑–∞—è–≤–∫–∏ (—á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –∏–ª–∏ /role).
–§–æ—Ä–º–∞—Ç:

üìù –õ–∏—á–Ω–æ–µ –¥–µ–ª–æ:
üë§ –ò–≥—Ä–æ–∫: @Western | –ú–∞–∫—Å–∏–º
üëÆ –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä: @Sulio | –°—É–ª–µ–π–º–∞–Ω
üìã –ú–µ—Ç–æ–¥ –ø—Ä–∏–Ω—è—Ç–∏—è: –ö–Ω–æ–ø–∫–∞ "–û–¥–æ–±—Ä–∏—Ç—å"
Discord: Western | –ú–∞–∫—Å–∏–º
Discord ID: 352921412148789268
–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω: 31.08.2017 21:03
Steam URL: https://steamcommunity.com/id/polonezwest
SteamID64: 76561199001250843
–ß–∞—Å—ã –≤ Rust: 222
üìã –î–µ—Ç–∞–ª–∏ –ø—Ä–∏–Ω—è—Ç–∏—è:
–î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è: <—Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞>
–†–æ–ª—å –≤—ã–¥–∞–Ω–∞: @–ù–æ–≤–∏—á–æ–∫

6. handlers/steam_api.py

–î–æ–±–∞–≤—å —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç Steam vanity URL ‚Üí SteamID64. –ï—Å–ª–∏ —Å—Å—ã–ª–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ /id/username, –≤—ã–∑—ã–≤–∞–π ResolveVanityURL. –ï—Å–ª–∏ —É–∂–µ steamid64, —Å–æ—Ö—Ä–∞–Ω—è–π –Ω–∞–ø—Ä—è–º—É—é.

‚úÖ –õ–æ–≥–∏–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–ö–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –¥–∞–∂–µ –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞.

–ù–∏–∫ –∏–≥—Ä–æ–∫–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è: –µ—Å–ª–∏ Discord != Steam ‚Üí –±–æ—Ç –ø–∏—à–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ + –∫–Ω–æ–ø–∫–∏.

–ó–µ–ª—ë–Ω–∞—è –∫–Ω–æ–ø–∫–∞ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ–Ω–∞ –Ω–∏–∫–∞ ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∑–∞—è–≤–∫—É.

–ö—Ä–∞—Å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ ‚Üí –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞.

–ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∑–∞—è–≤–∫–∏ ‚Üí –æ—Ç—á—ë—Ç –≤ üìÇ–ª–∏—á–Ω—ã–µ-–¥–µ–ª–∞ —Å SteamID64.

–û—à–∏–±–æ–∫ —Å allowed_mentions –∏ TypeError: expected string or bytes-like object –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç.

üëâ –í–Ω–µ—Å–∏ –≤—Å–µ —ç—Ç–∏ –ø—Ä–∞–≤–∫–∏ –≤–æ –≤—Å–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã.